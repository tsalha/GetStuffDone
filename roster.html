<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Roster - Get Stuff Done Committee</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* THEME — update these once you confirm exact HEX from school site */
    :root{
      --brand-primary:#1d3557; /* TODO: replace with school primary */
      --brand-accent:#e0b000;  /* TODO: replace with school accent */
      --text:#0b0b0b; --muted:#555; --bg:#ffffff; --card:#f7f7f8; --ok:#1b8a5a; --warn:#a65e00;
      --radius:18px; --pad:16px; --gap:12px; --shadow:0 6px 20px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text)}
    header{padding:28px var(--pad); background:linear-gradient(180deg,var(--brand-primary),#0e223a); color:white}
    .wrap{max-width:920px;margin:0 auto;padding:0 var(--pad)}
    h1{font-size:28px;margin:0 0 6px}
    .sub{opacity:.9}
    .event{background:var(--card); border-radius:var(--radius); padding:var(--pad); box-shadow:var(--shadow); margin:18px 0}
    .event h3{margin:0 0 6px}
    .grid{display:grid; gap:var(--gap)}
    .btn{display:inline-block; padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600}
    .btn.primary{background:var(--brand-accent); border:none}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; background:#eef; margin-left:8px; font-size:12px}
    .names{display:flex; flex-wrap:wrap; gap:6px; margin-top:6px}
    .name{background:white; border:1px solid #eee; padding:6px 10px; border-radius:999px}
    form.signup{display:grid; gap:8px; grid-template-columns:1fr 1fr}
    form.signup input{padding:10px;border-radius:10px;border:1px solid #ccc}
    form.signup .full{grid-column:1/-1}
    .notice{font-size:12px; color:var(--muted)}
    .capacity{font-size:13px; color:var(--muted)}
    .adminbar{position:sticky; top:0; background:#111; color:white; padding:8px var(--pad)}
    .hide{display:none}
    #rosterList {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: clamp(10px, 4vw, 14px); 
    }
    #rosterList li.not-active {
      text-decoration: line-through;
      opacity: 0.6 }
      #subscribeModal.hide {
    display: none;
  }
  #subscribeModal {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;              /* only applied when .hide is removed */
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  </style>
  
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Get Stuff Done Committee</h1>
      <div class="sub">Roster</div>
    </div>
  </header>

  <main class="wrap" style="margin-top: 24px;">

  <div style="margin-top: 20px;">
    <a href="#" id="openSubscribe" class="btn">Subscribe (or subscribe a friend)</a>
    <a href="#" id="openUnsubscribe" class="btn">Unsubscribe</a>
  </div>

    <main class="wrap" style="margin-top: 24px;">

    <!-- Subscription Modal -->
    <div id="subscribeModal" class="hide">
      <div style="background:white; padding:24px; border-radius:16px; max-width:400px; width:90%;">
        <h2>Subscribe to Roster</h2>
        <form id="subscribeForm" style="display:grid; gap:12px;">
          <input type="text" name="firstName" placeholder="First Name" required>
          <input type="text" name="lastName" placeholder="Last Name" required>
          <input type="email" name="email" placeholder="Email" required>
          <input type="tel" name="phone" placeholder="Phone">
          <button type="submit" class="btn primary">Submit</button>
          <button type="button" id="closeModal" class="btn" style="background:#eee;">Cancel</button>
        </form>
        <div id="subscribeNotice" style="margin-top:10px; font-size:14px;"></div>
      </div>
    </div>

    <!-- Unsubscribe Modal -->
    <div id="unsubscribeModal" class="hide" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1000;">
      <div style="background:white; padding:24px; border-radius:16px; max-width:400px; width:90%;">
        <h2>Unsubscribe from Roster</h2>
        <form id="unsubscribeForm" style="display:grid; gap:12px;">
          <select name="memberId" id="unsubscribeSelect" required>
            <option value="">Select a member</option>
          </select>
          <button type="submit" class="btn primary">Unsubscribe</button>
          <button type="button" id="closeUnsubModal" class="btn" style="background:#eee;">Cancel</button>
        </form>
        <div id="unsubscribeNotice" style="margin-top:10px; font-size:14px;"></div>
      </div>
    </div>
      
    <!-- Roster Container -->
    <div id="rosterContainer" style="margin-top: 24px;">
      <ul id="rosterList"></ul>
    </div>

</main>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw4T5tw1oO56KLYyIrkyyrAC-AUdht_mN2jwSSqIptd13he7VrcnYNnJ1E_veZziToO/exec';
    const ROSTER_URL = 'https://script.google.com/macros/s/AKfycbw4T5tw1oO56KLYyIrkyyrAC-AUdht_mN2jwSSqIptd13he7VrcnYNnJ1E_veZziToO/exec?type=roster';  
  
    //Subscribe
    document.getElementById('openSubscribe').addEventListener('click', e => {
      e.preventDefault();
      document.getElementById('subscribeModal').classList.remove('hide');
    });
  
    document.getElementById('closeModal').addEventListener('click', () => {
      document.getElementById('subscribeModal').classList.add('hide');
      document.getElementById('subscribeNotice').textContent = '';
      document.getElementById('subscribeForm').reset();
      fetchRoster();  
    });
  
    document.getElementById('subscribeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = {
        action: 'add_roster', // we’ll handle this in Apps Script
        firstName: form.firstName.value.trim(),
        lastName: form.lastName.value.trim(),
        email: form.email.value.trim(),
        phone: form.phone.value.trim(),
        status: 'Active'
      };
  
      try {
        const res = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(data)
        });
        const result = await res.json();
  
        if (result.ok) {
          document.getElementById('subscribeNotice').textContent = 'Successfully added!';
          form.reset();
          fetchRoster(); // refresh roster list
        } else {
          document.getElementById('subscribeNotice').textContent = 'Error: ' + (result.error || 'unknown');
        }
  
      } catch (err) {
        console.error(err);
        document.getElementById('subscribeNotice').textContent = 'Error submitting form.';
      }
    });

    // Unsubscribe
    document.getElementById('openUnsubscribe').addEventListener('click', e => {
      e.preventDefault();
      const unsubscribeModal = document.getElementById('unsubscribeModal');
      const select = document.getElementById('unsubscribeSelect');
      select.innerHTML = '<option value="">Select a member</option>';
    
      fetch(ROSTER_URL)
        .then(res => res.json())
        .then(data => {
          if (!data.ok || !data.roster) return;
          // Sort roster alphabetically
          data.roster.sort((a, b) => {
            const lastA = (a['Last Name'] || '').toLowerCase();
            const lastB = (b['Last Name'] || '').toLowerCase();
            return lastA.localeCompare(lastB);
          });
          data.roster.forEach((member, idx) => {
            const option = document.createElement('option');
            option.value = idx; 
            option.textContent = `${member['First Name']} ${member['Last Name']}`;
            select.appendChild(option);
          });
        });
    
      unsubscribeModal.classList.remove('hide');
    });
    
    document.getElementById('closeUnsubModal').addEventListener('click', () => {
      document.getElementById('unsubscribeModal').classList.add('hide');
      document.getElementById('unsubscribeNotice').textContent = '';
    });
    
    document.getElementById('unsubscribeForm').addEventListener('submit', async e => {
      e.preventDefault();
      const select = document.getElementById('unsubscribeSelect');
      const memberIndex = select.value;
      if (memberIndex === '') return;
    
      try {
        const rosterRes = await fetch(ROSTER_URL);
        const rosterData = await rosterRes.json();
        const member = rosterData.roster[memberIndex];
    
        const res = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'update_roster', // you’ll handle this in Apps Script
            firstName: member['First Name'],
            lastName: member['Last Name'],
            email: member['email'] || '',
            phone: member['phone'] || '',
            status: 'Not Active'
          })
        });
        const result = await res.json();
    
        if (result.ok) {
          document.getElementById('unsubscribeNotice').textContent = 'Successfully unsubscribed!';
          fetchRoster(); // refresh roster list
          document.getElementById('unsubscribeModal').classList.add('hide');
        } else {
          document.getElementById('unsubscribeNotice').textContent = 'Error: ' + (result.error || 'unknown');
        }
      } catch (err) {
        console.error(err);
        document.getElementById('unsubscribeNotice').textContent = 'Error unsubscribing.';
      }
    });

  
  // Generate Roster
  async function fetchRoster() {
    try {
      const res = await fetch(ROSTER_URL);
      const data = await res.json();

      const rosterList = document.getElementById('rosterList');
      rosterList.innerHTML = '';

      if (!data.ok || !data.roster) {
        rosterList.innerHTML = '<li style="color:red;">Failed to load roster.</li>';
        return;
      }

      data.roster.forEach(member => {
        const firstName = member['First Name'] || '';
        const lastName = member['Last Name'] || '';
        const status = member['status'] || 'Active';

        const li = document.createElement('li');
        li.textContent = `${firstName} ${lastName}`;
        if (status.toLowerCase() === 'not active') li.classList.add('not-active');

        rosterList.appendChild(li);
      });

    } catch (err) {
      console.error(err);
      document.getElementById('rosterList').innerHTML = '<li style="color:red;">Error fetching roster.</li>';
    }
  }

  fetchRoster();
</script>

    <footer>
    <div class="wrap">
      <p>&copy; Get Stuff Done Committee</p>
    </div>
  </footer>
</body>
</html>
